<section class="shop">
  <div class="shop-header">
    <h2>Shop</h2>
    <div class="filter-wrapper">
      <button class="icon filter-btn" (click)="toggleFilter()" aria-label="Filter">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
        </svg>
      </button>
      @if (isFilterOpen()) {
        <div class="filter-menu">
          <div class="filter-header">Categories</div>
          <ul>
            <li [class.active]="productService.selectedCategory() === null" (click)="selectCategory(null)">All</li>
            @for (c of productService.categories(); track c.id) {
              <li [class.active]="productService.selectedCategory() === c.id" (click)="selectCategory(c.id)">{{ c.name }}</li>
            }
          </ul>
          <div class="filter-header mt-3" style="margin-top: 1rem; border-top: 1px solid #eee; padding-top: 0.5rem;">Companies</div>
          <ul>
            <li [class.active]="productService.selectedCompany() === null" (click)="selectCompany(null)">All</li>
            @for (c of productService.companies(); track c.companyId) {
              <li [class.active]="productService.selectedCompany() === c.companyId" (click)="selectCompany(c.companyId)">{{ c.name }}</li>
            }
          </ul>
        </div>
      }
    </div>
  </div>

  @if (productService.products().length === 0) {
    <p>No products found.</p>
  } @else {
    <app-product-list 
      [products]="paginatedProducts()" 
      (selectProduct)="onSelectProduct($event)"
      (loadMore)="loadMore()">
    </app-product-list>
  }

  @if (productService.loading()) {
    <div class="loading-overlay">
      <p>Loading more...</p>
    </div>
  }
</section>

@if (selectedProduct()) {
  <app-product-detail 
    [product]="selectedProduct()!" 
    (onClose)="closeProductDetail()">
  </app-product-detail>
}
