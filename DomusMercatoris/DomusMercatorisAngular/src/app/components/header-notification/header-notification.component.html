<!-- Notification Bell -->
<button class="icon" aria-label="notifications" (click)="handleNotificationsClick()" style="position: relative;">
  <!-- Bell SVG -->
  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
  </svg>
  @if (unreadCount > 0) {
    <span class="cart-badge">{{ unreadCount }}</span>
  }
</button>

<!-- Floating Notification (Always Visible if Active and History Closed) -->
@if (activeNotification && !isNotificationsOpen) {
  <div class="payment-notification-floating">
    <div class="notification-arrow"></div>
    <div class="notification-header">
      <div class="header-center">
        <span class="bank-icon">üèõ</span>
        <span class="bank-name">Solidus Bank</span>
      </div>
      <div class="header-right">
        <span class="time">Now</span>
        <button class="close-btn" (click)="closeNotification(activeNotification!.code, $event)">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
    </div>
    <div class="notification-body">
      <p class="msg-text">Transaction of <strong>{{ activeNotification!.amount | currency:'USD' }}</strong> initiated.</p>
      <p class="msg-code">Your verification code: <span class="code-box">{{ activeNotification!.code }}</span></p>
      <p class="msg-warning">‚ö†Ô∏è DO NOT SHARE THIS CODE</p>
    </div>
  </div>
}

@if (isNotificationsOpen) {
  <div class="cart-dropdown"> <!-- Reuse cart dropdown styles for consistency -->
    <div class="cart-header">
      <span>Notifications</span>
      <span class="count">{{ notifications().length }} total</span>
    </div>
    <div class="cart-items">
      @for (note of notifications(); track note.code) {
        <div class="cart-item" [class.unread]="!note.read">
          <div class="note-content">
             <div class="note-top">
               <span class="bank-name-small">Solidus Bank</span>
               <span class="note-time">{{ note.time | date:'shortTime' }}</span>
             </div>
             <div class="note-msg">
               Code: <strong>{{ note.code }}</strong> for {{ note.amount | currency:'USD' }}
             </div>
          </div>
          <button class="delete-note-btn" (click)="deleteNotification(note.code, $event)" title="Delete">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
          </button>
        </div>
      }
      @if (notifications().length === 0) {
        <div class="empty">No notifications.</div>
      }
    </div>
  </div>
}
