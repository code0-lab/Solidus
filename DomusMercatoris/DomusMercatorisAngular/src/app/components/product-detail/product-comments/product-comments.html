<div class="comments-section">
  <div class="comments-list">
    @for (comment of commentService.comments(); track comment.id) {
      <div class="comment-item">
        <div class="comment-header">
          <strong>{{ comment.userFullName }}</strong>
          <span class="date">{{ comment.createdAt | date:'dd.MM.yyyy' }}</span>
          @if (!comment.isApproved) {
            <span class="badge-pending">Pending</span>
          }
        </div>
        
        @if (editingCommentId() === comment.id) {
          <div class="edit-mode">
            <textarea [(ngModel)]="editCommentText" rows="3"></textarea>
            <div class="edit-actions">
              <button class="save-btn" (click)="saveEdit(comment)">Save</button>
              <button class="cancel-btn" (click)="cancelEdit()">Cancel</button>
            </div>
          </div>
        } @else {
          <p>{{ comment.text }}</p>
          @if (authService.currentUser()?.id === comment.userId) {
            <button class="edit-link" (click)="startEdit(comment)">Edit</button>
          }
        }
      </div>
    }
    @if (commentService.comments().length === 0) {
      <p class="no-comments">No comments yet.</p>
    }
  </div>

  @if (authService.currentUser()) {
    <div class="add-comment">
      <textarea 
        [(ngModel)]="newCommentText" 
        placeholder="Write your comment..."
        rows="3">
      </textarea>
      <button class="submit-comment-btn" (click)="postComment()">Post Comment</button>
    </div>
  } @else {
    <div class="login-prompt">
      <p>You must be logged in to post a comment.</p>
      <button class="login-btn" (click)="authService.toggleLogin()">Log In</button>
    </div>
  }
</div>
