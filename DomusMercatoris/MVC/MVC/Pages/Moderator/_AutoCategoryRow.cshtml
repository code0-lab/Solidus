@model DomusMercatoris.Core.Entities.AutoCategory
@{
    var depth = (int)ViewData["Depth"];
    var allCats = (List<DomusMercatoris.Core.Entities.AutoCategory>)ViewData["AllCats"];
    var padding = depth * 20;
}
<tr>
    <td class="ps-3">
        <div style="padding-left: @(padding)px;">
            @if(depth > 0) { <i class="bi bi-arrow-return-right text-muted me-2"></i> }
            <span class="fw-bold">@Model.Name</span>
            @if (!string.IsNullOrEmpty(Model.Description))
            {
                <br/>
                <small class="text-muted" style="padding-left: @(depth > 0 ? 24 : 0)px;">@Model.Description</small>
            }
        </div>
    </td>
    <td>
        @if (Model.ProductClusters != null && Model.ProductClusters.Any())
        {
            foreach(var cluster in Model.ProductClusters)
            {
                <span class="badge bg-info text-dark d-inline-block me-1 mb-1">
                    @cluster.Name (v@(cluster.Version))
                </span>
            }
        }
        else
        {
            <span class="badge bg-secondary">No Clusters</span>
        }
    </td>
    <td>
        <small class="text-muted">@Model.CreatedAt.ToShortDateString()</small>
    </td>
    <td class="text-end pe-3">
        <div class="btn-group btn-group-sm">
            <a href="?editId=@Model.Id" class="btn btn-outline-primary">
                <i class="bi bi-pencil"></i>
            </a>
            <form method="post" asp-page-handler="Delete" asp-route-id="@Model.Id" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this auto category?');">
                <button type="submit" class="btn btn-outline-danger">
                    <i class="bi bi-trash"></i>
                </button>
            </form>
        </div>
    </td>
</tr>

@{
    var children = allCats.Where(x => x.ParentId == Model.Id).OrderBy(x => x.Name);
    foreach(var child in children)
    {
        var childViewData = new ViewDataDictionary(ViewData);
        childViewData["Depth"] = depth + 1;
        childViewData["AllCats"] = allCats;
        <partial name="_AutoCategoryRow" model="child" view-data="childViewData" />
    }
}
